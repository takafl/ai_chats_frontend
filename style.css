@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500;600&display=swap');

/* =========================================================
   ðŸŽ¨ Design Tokens â€” Soft & Warm Palette
   ========================================================= */
:root {
  /* Warm indigo - easier on the eyes than pure blue */
  --primary: #5b5fc7;
  --primary-light: #7c7ff2;
  --primary-dark: #4a4eb3;
  --primary-glow: rgba(91,95,199,0.18);

  /* Surfaces â€” warm whites, not harsh */
  --surface: #ffffff;
  --surface-2: #fafbfd;
  --surface-3: #f0f2f7;
  --text: #1a1d2e;
  --text-2: #5a5f7a;
  --text-3: #9095ab;
  --border: #e4e7f0;
  --border-2: #d0d4e0;

  --sidebar-bg: #fafbfd;
  --topbar-bg: rgba(250,251,253,0.88);
  --chat-bg: #f5f6fa;
  --bot-bubble: #ffffff;
  --user-bubble: rgba(91,95,199,0.07);
  --code-bg: #1a1d2e;

  --shadow-sm: 0 1px 3px rgba(26,29,46,0.05);
  --shadow-md: 0 4px 14px rgba(26,29,46,0.07);
  --shadow-lg: 0 10px 35px rgba(26,29,46,0.09);

  --radius: 12px;
  --radius-lg: 16px;
  --radius-xl: 20px;
  --ease: cubic-bezier(0.4,0,0.2,1);
  --app-vh: 1vh;

  /* Avatar colors */
  --avatar-user: linear-gradient(135deg, #5b5fc7, #7c7ff2);
  --avatar-bot: linear-gradient(135deg, #e8590c, #f76707);
}

html.dark {
  --primary: #8b8ff5;
  --primary-light: #a8abff;
  --primary-dark: #6c70e0;
  --primary-glow: rgba(139,143,245,0.16);

  --surface: #0e1225;
  --surface-2: #141834;
  --surface-3: #1c2042;
  --text: #e4e6f0;
  --text-2: #9095ab;
  --text-3: #5f6480;
  --border: rgba(148,155,185,0.1);
  --border-2: rgba(148,155,185,0.16);

  --sidebar-bg: rgba(14,18,37,0.97);
  --topbar-bg: rgba(14,18,37,0.88);
  --chat-bg: #0e1225;
  --bot-bubble: rgba(20,24,52,0.92);
  --user-bubble: rgba(139,143,245,0.08);
  --code-bg: #090c1a;

  --shadow-sm: 0 1px 3px rgba(0,0,0,0.25);
  --shadow-md: 0 4px 14px rgba(0,0,0,0.35);
  --shadow-lg: 0 10px 35px rgba(0,0,0,0.45);

  --avatar-user: linear-gradient(135deg, #7c7ff2, #a8abff);
  --avatar-bot: linear-gradient(135deg, #f76707, #ff922b);
}

/* =========================================================
   Reset
   ========================================================= */
*,*::before,*::after{box-sizing:border-box}
html{width:100%;height:100%;overflow:hidden;overscroll-behavior:none}
body{
  font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;
  width:100%;height:calc(var(--app-vh)*100);min-height:calc(var(--app-vh)*100);
  overflow:hidden;overscroll-behavior:none;
  background:var(--chat-bg);color:var(--text);
  transition:background-color .35s ease,color .35s ease;
  -webkit-font-smoothing:antialiased;
}
html,body,main,#chat-container,#chat-box{overflow-x:hidden}

/* =========================================================
   Layout
   ========================================================= */
main{margin-top:0;height:calc(var(--app-vh)*100);display:flex;flex-direction:column;min-height:0}
#chat-container{display:flex;flex:1 1 auto;overflow:hidden;min-height:0;min-width:0}
#chat-container>aside,#chat-container>div{height:100%;min-height:0}
#chat-container>div{display:flex;flex-direction:column;min-height:0;min-width:0}
#chat-container>div,#chat-container>aside,.msg-bubble{min-width:0}

/* =========================================================
   Sidebar
   ========================================================= */
#sidebar{width:300px;flex:0 0 300px;background:var(--sidebar-bg);border-right:1px solid var(--border);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px)}
.glass-sidebar{backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px)}
#sidebar-overlay.hidden{display:none!important;pointer-events:none!important}

/* =========================================================
   Topbar
   ========================================================= */
#topbar{background:var(--topbar-bg);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid var(--border)}

/* =========================================================
   âœ… SELECT / DROPDOWN â€” DARK MODE FIX
   ========================================================= */
select{
  cursor:pointer;
  -webkit-appearance:none;-moz-appearance:none;appearance:none;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%239095ab' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:right 6px center;
  padding-right:22px!important;
}
select option{padding:8px 12px;font-family:'Inter',sans-serif;font-size:13px}
html:not(.dark) select option{background:#ffffff!important;color:#1a1d2e!important}
html.dark select option{background:#1c2042!important;color:#e4e6f0!important}
html.dark select option:checked{background:#2a2f5a!important;color:#f0f1ff!important}

.select-pill{
  display:flex;align-items:center;gap:6px;
  background:var(--surface-3);border:1px solid var(--border);
  padding:5px 10px 5px 12px;border-radius:999px;
  transition:all .2s var(--ease);
}
.select-pill:hover{border-color:var(--primary);box-shadow:0 0 0 3px var(--primary-glow)}
.select-pill select{background:transparent;border:none;outline:none;font-size:12px;font-weight:500;color:var(--text)}

/* =========================================================
   Quota
   ========================================================= */
#quota-panel{background:var(--surface);border-bottom:1px solid var(--border)}
html.dark #quota-panel{background:var(--surface-2)}
#quota-fill{background:linear-gradient(90deg,var(--primary),var(--primary-light));border-radius:999px;transition:width .6s ease}
#quota-text{overflow-wrap:anywhere;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}

/* =========================================================
   Chat Area
   ========================================================= */
#chat-box{flex:1 1 auto;min-height:0;overflow-y:auto;overflow-x:hidden;scroll-behavior:smooth;background:var(--chat-bg);padding-bottom:0}
#chat-box::-webkit-scrollbar{width:5px}
#chat-box::-webkit-scrollbar-track{background:transparent}
#chat-box::-webkit-scrollbar-thumb{background:var(--text-3);border-radius:10px;opacity:0.5}
#chat-box::-webkit-scrollbar-thumb:hover{background:var(--text-2)}

/* =========================================================
   âœ… Message Avatars â€” ALWAYS VISIBLE
   ========================================================= */
.msg-avatar{
  width:34px;
  height:34px;
  min-width:34px;
  min-height:34px;
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-shrink:0;
}

.msg-avatar-user{
  background:var(--avatar-user);
  box-shadow:0 4px 12px var(--primary-glow);
}

.msg-avatar-bot{
  background:var(--avatar-bot);
  box-shadow:0 4px 12px rgba(247,103,7,0.2);
}

/* Ensure SVG inside avatar is always visible */
.msg-avatar svg{
  display:block;
  stroke:white!important;
  fill:none;
}

/* =========================================================
   Chat Bubbles
   ========================================================= */
.msg-bubble{
  border-radius:var(--radius-xl);
  max-width:min(85%,48rem);width:fit-content;
  overflow-wrap:anywhere;word-break:break-word;hyphens:auto;
  transition:box-shadow .2s var(--ease);
}
.msg-bubble.msg-bot{
  background:var(--bot-bubble)!important;
  border:1px solid var(--border);
  box-shadow:var(--shadow-sm);
}
.msg-bubble.msg-user{
  background:var(--user-bubble)!important;
  border:1px solid rgba(91,95,199,0.12);
}
html.dark .msg-bubble.msg-bot{background:var(--bot-bubble)!important;border-color:var(--border)!important;box-shadow:var(--shadow-md)}
html.dark .msg-bubble.msg-user{background:var(--user-bubble)!important;border-color:rgba(139,143,245,0.15)!important}

/* =========================================================
   Markdown / Prose
   ========================================================= */
.prose{max-width:100%!important;line-height:1.75!important;color:inherit!important;overflow-wrap:anywhere!important;word-break:break-word!important;hyphens:auto;direction:ltr;text-align:left}
.prose p{margin-bottom:1.1rem!important}
.prose strong{color:inherit!important;font-weight:600}
.prose,.prose *{max-width:100%}
.prose a{color:var(--primary);text-decoration:underline;text-decoration-color:var(--primary-glow);text-underline-offset:2px;overflow-wrap:anywhere;word-break:break-word}
.prose a:hover{color:var(--primary-light)}
.prose img,.prose video,.prose iframe,.prose canvas,.prose svg{max-width:100%!important;height:auto!important;border-radius:var(--radius)}
.prose table{display:block;max-width:100%!important;overflow-x:auto;border-collapse:collapse}
.prose table th,.prose table td{padding:8px 12px;border:1px solid var(--border);font-size:.9em}
.prose table th{background:var(--surface-3);font-weight:600}

/* Inline code */
.prose :not(pre)>code{
  font-family:"Fira Code",ui-monospace,SFMono-Regular,Menlo,monospace!important;
  font-size:.85em!important;line-height:1.6;unicode-bidi:plaintext;
  padding:2px 7px;border-radius:6px;
  border:1px solid var(--border);background:var(--surface-3);color:var(--primary-dark);
}
html.dark .prose :not(pre)>code{background:rgba(139,143,245,0.1);border-color:rgba(139,143,245,0.2);color:var(--primary-light)}

/* Code blocks */
.prose pre,.prose code,.prose pre code{direction:ltr!important;text-align:left!important;unicode-bidi:plaintext}
.prose pre{
  overflow:auto!important;max-width:100%!important;white-space:pre;tab-size:4;line-height:1.6;font-size:.88em;
  border-radius:var(--radius-lg);padding:16px 18px;margin:14px 0;
  border:1px solid var(--border);background:var(--code-bg)!important;position:relative;
  max-height:min(45vh,calc((var(--app-vh)*100) - 18rem))!important;
}
.prose pre code{display:block!important;background:transparent!important;border:none!important;padding:0!important;font-size:inherit!important}

/* Copy button */
.copy-btn{position:absolute;right:8px;top:8px;padding:4px 10px;background:rgba(30,41,59,0.9);border:1px solid rgba(148,163,184,0.15);border-radius:6px;color:#9095ab;font-size:11px;font-weight:500;cursor:pointer;opacity:0;transition:all .2s var(--ease);backdrop-filter:blur(8px)}
.prose pre:hover .copy-btn{opacity:1}
.copy-btn:hover{background:rgba(51,65,85,0.9);color:#e2e8f0}
.copy-btn.copied{background:rgba(16,185,129,0.2);color:#10b981;border-color:rgba(16,185,129,0.3)}

/* =========================================================
   Direction
   ========================================================= */
.msg-rtl{direction:rtl;text-align:right}
.msg-ltr{direction:ltr;text-align:left}

/* =========================================================
   Composer
   ========================================================= */
#chat-box+div{flex:0 0 auto;padding-top:8px;padding-bottom:8px}
#composer{
  flex-wrap:nowrap!important;gap:.5rem;padding:6px 8px;
  border-radius:var(--radius-xl);background:var(--surface);
  border:1px solid var(--border);box-shadow:var(--shadow-lg);
  transition:all .3s ease;
}
html.dark #composer{background:var(--surface-2);border-color:var(--border-2)}
#composer:focus-within{border-color:var(--primary);box-shadow:0 0 0 3px var(--primary-glow),var(--shadow-lg)}
#composer textarea,#user-in{min-height:44px!important;max-height:140px!important;overflow-y:auto!important;padding-top:10px!important;padding-bottom:10px!important;font-size:14px;line-height:20px;color:var(--text);background:transparent}

/* =========================================================
   âœ… Send Button â€” with spinner state
   ========================================================= */
#send-btn{
  width:40px;height:40px;min-width:40px;min-height:40px;
  border-radius:50%;
  background:var(--avatar-user);
  color:white;border:none;
  box-shadow:0 3px 12px var(--primary-glow);
  transition:all .25s var(--ease);
  display:flex;align-items:center;justify-content:center;
  flex-shrink:0;
  cursor:pointer;
}
#send-btn:hover{
  transform:translateY(-1px);
  box-shadow:0 5px 18px var(--primary-glow);
}
#send-btn:active{transform:scale(0.93)}

/* ðŸ”´ Stop / streaming state */
#send-btn.stop-btn{
  background:linear-gradient(135deg,#ef4444,#dc2626)!important;
  box-shadow:0 3px 12px rgba(239,68,68,0.25)!important;
  animation:gentle-pulse 1.5s ease-in-out infinite;
}

@keyframes gentle-pulse{
  0%,100%{box-shadow:0 3px 12px rgba(239,68,68,0.25)}
  50%{box-shadow:0 3px 20px rgba(239,68,68,0.4)}
}

/* âœ… Spinner rotation */
.spin-icon{
  animation:spin 0.8s linear infinite;
}
@keyframes spin{
  from{transform:rotate(0deg)}
  to{transform:rotate(360deg)}
}

/* =========================================================
   Sidebar Buttons
   ========================================================= */
#new-chat-btn{background:var(--avatar-user);box-shadow:0 4px 16px var(--primary-glow);border:none;transition:all .2s var(--ease)}
#new-chat-btn:hover{transform:translateY(-1px);box-shadow:0 6px 24px var(--primary-glow)}
#clear-history{background:rgba(239,68,68,0.05);border:1px solid rgba(239,68,68,0.15);color:#ef4444;box-shadow:none;transition:all .2s var(--ease)}
#clear-history:hover{background:rgba(239,68,68,0.1);border-color:rgba(239,68,68,0.25)}
html.dark #clear-history{background:rgba(239,68,68,0.05);border-color:rgba(239,68,68,0.15);color:#f87171}

/* =========================================================
   Selection / Retry / Animations
   ========================================================= */
.selection-action-btn{position:absolute;z-index:50;background:var(--primary);color:#fff;border:none;padding:6px 12px;border-radius:999px;font-size:11px;font-weight:600;box-shadow:0 4px 14px var(--primary-glow);cursor:pointer}
.selection-action-btn.hidden{display:none}
.retry-btn{display:inline-flex;align-items:center;padding:8px 16px;border-radius:var(--radius);border:1px solid rgba(91,95,199,0.3);background:rgba(91,95,199,0.08);color:var(--primary);font-weight:600;font-size:.85rem;cursor:pointer;transition:all .2s var(--ease)}
.retry-btn:hover{background:rgba(91,95,199,0.15)}
.retry-btn:disabled{opacity:.5;cursor:not-allowed}
.fade-in{animation:fadeIn .4s cubic-bezier(0.16,1,0.3,1)}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.thinking-pulse{animation:pulse 2s ease-in-out infinite;color:var(--primary)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}

/* =========================================================
   Utilities
   ========================================================= */
.no-scrollbar{scrollbar-width:none;-ms-overflow-style:none}
.no-scrollbar::-webkit-scrollbar{display:none}
.line-clamp-2{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.line-clamp-3{display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
@supports(padding:max(0px)){.safe-bottom{padding-bottom:max(1rem,env(safe-area-inset-bottom))}}

/* =========================================================
   Theme Toggle
   ========================================================= */
theme-toggle{display:block!important;position:fixed!important;z-index:9999!important;right:14px!important;bottom:14px!important;left:auto!important;top:auto!important}
@media(max-width:767px){theme-toggle{bottom:80px!important}}

/* =========================================================
   Mobile
   ========================================================= */
@media(max-width:767px){
  #topbar{padding:8px 12px!important;gap:8px!important}
  #current-project-name{font-size:10px!important;line-height:12px!important}
  #current-chat-title{font-size:13px!important;line-height:16px!important;max-width:40vw!important;white-space:nowrap!important;overflow:hidden!important;text-overflow:ellipsis!important}
  #model-select,#thinking-level{font-size:11px!important}
  #topbar>div:last-child{flex-wrap:nowrap!important;overflow-x:auto!important;-webkit-overflow-scrolling:touch;max-width:65vw}
  #quota-panel{flex-direction:column;align-items:flex-start;gap:.5rem;padding:8px 12px}
  #quota-panel>div{width:100%}
  #chat-box{padding-left:12px;padding-right:12px}
}
@media(max-width:640px){
  #sidebar{width:85vw;flex-basis:85vw}
  #quota-text{font-size:11px;line-height:1.25}
  #composer textarea,#user-in{font-size:15px;max-height:120px!important}
  #attach-btn{padding:10px}
  #send-btn{border-radius:14px}
  .msg-avatar{width:28px;height:28px;min-width:28px;min-height:28px;border-radius:10px}
  .msg-avatar svg{width:14px;height:14px}
}

/* Modal */
#project-settings-modal>div{background:var(--surface);border:1px solid var(--border);box-shadow:var(--shadow-lg)}
html.dark #project-settings-modal>div{background:var(--surface-2);border-color:var(--border-2)}
